---
- name: Ensures minecraft_bedrock dir exists
  file:
    path: "{{ root_dir }}/minecraft_bedrock/data"
    state: directory

- name: Adding server.properties file
  template:
    src: ../templates/server.properties
    dest: "{{ root_dir }}/minecraft_bedrock/data/server.properties"
    mode: 0600

- name: Adding permissions.json file
  template:
    src: ../templates/permissions.json
    dest: "{{ root_dir }}/minecraft_bedrock/data/permissions.json"
    mode: 0600

- name: Add Dockerfile
  template:
    src: ../templates/Dockerfile
    dest: "{{ root_dir }}/minecraft_bedrock/Dockerfile"
    mode: 0600

- name: Adding bedrock-entry.sh file
  template:
    src: ../templates/bedrock-entry.sh
    dest: "{{ root_dir }}/minecraft_bedrock/bedrock-entry.sh"
    mode: u=rwX,g=rX,o=rX

- name: Adding property-definitions.json file
  template:
    src: ../templates/property-definitions.json
    dest: "{{ root_dir }}/minecraft_bedrock/property-definitions.json"
    mode: 0600

- name: Create the minecraft_bedrock image
  docker_image:
    name: minecraft_bedrock
    state: present
    source: build
    build:
      path: "{{ root_dir }}/minecraft_bedrock"
      pull: no

- name: Create the minecraft container
  docker_container:
    name: minecraft_bedrock
    image: minecraft_bedrock:latest
    restart_policy: unless-stopped
    ports: 
      - "19132:19132/udp"
    networks:
      - name: web
    volumes:
      - "{{ root_dir }}/minecraft_bedrock/data:/data"
    env:
      EULA: "TRUE"
      NAMECHEAP_API_USER: "{{ namecheap_api_user }}"
      NAMECHEAP_API_KEY: "{{ namecheap_api_key }}"
